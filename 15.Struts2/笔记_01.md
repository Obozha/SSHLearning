# Struts2_01

<!--markdownlint-disable MD007 -->
<!--markdownlint-disable MD004 -->
<!-- markdownlint-disable MD033 -->

## 学习路线

* 第一天：Struts的概述，Struts的入门、Struts2常见的配置、Struts2的Action的编写
* 第二天：Struts的数据的封装、结果页面配置
* 第三天：Struts的值栈和OGNL表达式
* 第四天：Struts的标签库

## Struts2的概述

### 什么是Struts2

> Struts2是一个基于MVC设计模式的Web应用框架，它本质上相当于一个servlet，在MVC设计模式中，Struts2作为控制器(Controller)来建立模型与视图的数据交互。Struts 2是Struts的下一代产品，是在 struts 1和WebWork的技术基础上进行了合并的全新的Struts 2框架。其全新的Struts 2的体系结构与Struts 1的体系结构差别巨大。Struts 2以WebWork为核心，采用拦截器的机制来处理用户的请求，这样的设计也使得业务逻辑控制器能够与ServletAPI完全脱离开，所以Struts 2可以理解为WebWork的更新产品。虽然从Struts 1到Struts 2有着太大的变化，但是相对于WebWork，Struts 2的变化很小。

* Struts2是一个基于MVC设计模式的<font color='red'>WEB层框架</font>
  * Struts2的内核相对于Struts1来讲已经发生巨大变化。

### 常见的Web层框架

* <font color='red'>Struts2</font>
* Strut1
* Webwork
* <font color='red'>SpringMVC</font>

### Web层框架基于前端控制器模型设计

![01](img/day_01/01.png)

* 注意这里的图不是指并发，而是指用户请求的时候，是怎么找到servlet或者action
* 下图是指servlet并发

* servlet的并发是单实例多线程的

![02](img/day_01/02.png)

## Struts2的入门

### 下载Struts2的开发环境

> [struts.apache.org](http://struts.apache.org/)

### 解压Struts2开发包

![03](img/day_01/03.png)

* apps  ：Struts2提供的应用，war文件：web项目打成war包 - 和jar有点类似，直接放到tomcat可以运行
* docs  ：Struts2的开发文档和api
* lib   ：Struts2框架的开发的jar包
* src   ：Struts2的源码

### 创建web项目，引入jar

* 引入jar
  * struts-blank下找jar包
  * ![04](img/day_01/04.png)

### 创建一个jsp页面

```java
<h1>Struts2入门</h1>
<h3>
    <a href="${ pageContext.request.contextPath }/hello.action">点击进入Hello.action</a>
</h3>
```

### 编写Action的类

```java
/**
* Struts2的入门Action类
* @author Administrator
*
*/
public class HelloAction {
    /**
    * 提供一个办法：
    * * 方法签名是固定的
    * * 共有的，返回值是String类型，方法名execute，在这个方法中不能传递参数
    */
    public String execute() {
        System.out.println("HelloAction执行了");
        return null;
    }
}
```

### 对Action进行配置

* 在src下创建（提供）名称叫做struts.xml的配置文件

```java
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE struts PUBLIC
    "-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"
    "http://struts.apache.org/dtds/struts-2.3.dtd">

<struts>
    <!-- Struts2为了管理Action的配置，通过包管理 -->
    <!-- 配置Struts2的包 -->
    <package name="demo1" extends="struts-default" namespace="/">
        <!-- 配置Action -->
        <action name="hello" class="cc.struts.action.HelloAction">
        </action>
    </package>
</struts>
```

* 这里要配置一下提示
    ![05](img/day_01/05.png)

### 配置前端控制器 | 核心过滤器

* 在`struts2-blank.war\WEB-INF\web.xml`可以找到配置

```xml
<!-- 配置Struts前端过滤器 -->
<filter>
    <filter-name>struts2</filter-name>
    <filter-class>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter</filter-class>
</filter>

<filter-mapping>
    <filter-name>struts2</filter-name>
    <url-pattern>/*</url-pattern>
</filter-mapping>
```

### 改写Action中方法的返回值 - 修改源码是支持热部署

```java
public String execute() {
    System.out.println("HelloAction执行了");
    return "success";
}
```

* 注意，到这里运行一下，
  * 如果`return null;`就会跳到一个空白页面
  * 如果`return "aaa"`就会得到一个错误`No result defined for action cc.struts.action.HelloAction and result aaa`

* 另外，eclipse支持热部署action

    ![06](img/day_01/06.png)

### 改写 struts.xml - 修改xml也可以立即生效的

```xml
<struts>
    <!-- Struts2为了管理Action的配置，通过包管理 -->
    <!-- 配置Struts2的包 -->
    <package name="demo1" extends="struts-default" namespace="/">
        <!-- 配置Action -->
        <action name="hello" class="cc.struts.action.HelloAction">
            <result name="success">/success.jsp</result>
        </action>
    </package>
</struts>
```

### 编写success.jsp

```html
<body>
    <h1>成功跳转页面</h1>
</body>
```

* 注意这里的跳转是内部直接跳，而不是重定向

## Struts2的执行流程

![07](img/day_01/07.png)

当用户访问某一个Action的时候，先经过核心过滤器，在核心过滤器中执行一组拦截器（这组拦截器实现部分功能），执行目标Action，根据Action的返回值，进行页面跳转

* 这里做了一个实验
  * 找到struts2-core-2.3.24.jar下的struts-default.xml
  * 在默认栈defaultStack里面装的有很多拦截器
  * 找对拦截器对应的类，通过`ctrl+shift+t`找到该类文件并关联代码
  * 然后分别在拦截器和Action加上断点，debug后能够看到Action的执行顺序

## Struts2的常见配置

### XML的提示配置

### Struts2的配置文件的加载顺序 - 了解

### Action的配置

### 常量的配置

### 分模块开发的配置

## Action的访问

## CRM的客户列表展示
